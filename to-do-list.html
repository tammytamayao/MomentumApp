<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sample To-Do list</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Advent+Pro:wght@200&family=Cabin:wght@400;500&family=Mina&family=Open+Sans&family=Poppins:wght@200&family=Prompt:wght@200&family=Roboto:wght@400&display=swap');
     * {
       position: relative;
       box-sizing: border-box;
     }
 
     /*container style*/
     .container {
       max-width: 280px;
       background-color: #fff;
       border-radius: 5px;
       box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
     }
 
     /*Style Input and title*/
     .header {
       position: relative;
       padding: 10px 5px 10px 20px;
     }
 
     .header input {
       width: 200px;
       height: 30px;
       font-family: 'Roboto', sans-serif;
     }
 
     input[type=checkbox]:hover {
       cursor: pointer;
     }
 
     .header button {
       width: 30px;
       height: 30px;
     }
 
     #title {
       font-family: 'Roboto', sans-serif;
     }
 
     /* Checkbox when checked*/
     input[type=checkbox]:checked+label.textlabel {
       text-decoration: line-through;
       color: gray;
     }
 
     /*remove padding of list*/
     ul {
       padding-inline-start: 0;
     }
 
     /*design of to-do list item*/
     ul li {
       background: #fff;
       font-size: 16px;
       transition: 0.2s;
       list-style: none;
       position: relative;
       padding: 10px 5px 10px 20px;
       font-family: 'Roboto',sans-serif;
     }
 
     /*Change background of list item when hover*/
     ul li:hover {
       background: beige;
     }
 
     /*Style close button*/
     .close {
       position: absolute;
       right: 0;
       top: 0;
       padding: 10px 15px 10px 15px;
     }
 
     /*Change background of close button when hover*/
     .close:hover {
       background-color: #f44336;
       color: white;
       cursor: pointer;
     }
 
     /*Style add item button */
     .AddBtn {
       background-color: #bbb;
       cursor: pointer;
       transition: 0.3s;
       border:1px;
     }
 
     /*Change background of add button when hover*/
     .AddBtn:hover {
       background-color: BEIGE;
       
     }
   </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h2 id="title">My To Do List</h2>
      <form>
        <input type="text" id="input" placeholder="Add new task." autocomplete="off">
        <button onclick="newToDo()" class="AddBtn" type="submit">+</button>
      </form>
    </div>

    <div>
      <ul id="ul" class="todo-list"></ul>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>

  <script>

//get stored value from todolist and copy it to new array
  let tempToDoList = [];
    if (localStorage.getItem('toDoList') != null) {
      tempToDoList = JSON.parse(localStorage.getItem('toDoList'));
    }

// [ 1:{ text: 'aksdjasd', done: true }]
  var toDoList = [];
    if (tempToDoList.length > 0) {
      toDoList = tempToDoList;
      toDoList.forEach(function (item, index) {
        displayList(item, index);
      })
    }

// Retain checked checkbox when refresh
  $('.todo-list').on('change', '.listItem', function () {
    let doneTask = $(this).is(':checked');
    let listIndex = $(this).closest('li').data('index');
    let taskList = JSON.parse(localStorage.getItem('toDoList'));
    let listItem = taskList[listIndex];
      listItem.done = doneTask;
      localStorage.setItem('toDoList', JSON.stringify(taskList));
  })

//add to-do list item and store it in web browser
  function newToDo() {
    var list = document.createElement("li");
    var input = document.getElementById("input").value;

    var checkbox = document.createElement('input');
      checkbox.type = "checkbox";
      checkbox.name = "checkbox";
      checkbox.id = "checkbox";
      checkbox.className = 'listItem';

    var label = document.createElement('label');
      label.className = "textlabel";
      label.appendChild(document.createTextNode(input));
      list.appendChild(checkbox);
      list.appendChild(label);

    if (input === '') {
      alert("Write what you want to do!");
    } else {
      document.querySelector("form").addEventListener("submit", e => {
        e.preventDefault();
      });
      document.getElementById("ul").appendChild(list);
    }
      document.getElementById("input").value = "";

    if (input!== ''){
      var span = document.createElement("span");
      var text = document.createTextNode("\u00D7");
      span.className = "close";
      span.appendChild(text);
      list.appendChild(span);
      toDoList.push({ text: input, done: false });
      localStorage.setItem('toDoList', JSON.stringify(toDoList));
      list.setAttribute('data-index', toDoList.length - 1);

    for (i = 0; i < close.length; i++) {
      close[i].onclick = function () {
      var div = this.parentElement;
      div.style.display = "none";
      if (close.onclick=true){
        let listIndex = $(this).data('index');
      let taskList = JSON.parse(localStorage.getItem('toDoList'));
      taskList.splice(listIndex,1);
      localStorage.setItem('toDoList', JSON.stringify(taskList));
      }
      }
    }
  }
}

//display stored list when refreshed
  function displayList(input, index) {
    var list = document.createElement("li");
      list.setAttribute('data-index', index);
    
    var checkbox = document.createElement('input');
      checkbox.type = "checkbox";
      checkbox.name = "todolist_" + index;
      checkbox.id = index;
      checkbox.className = 'listItem';

    var label = document.createElement('label');
      label.className = "textlabel";
      label.appendChild(document.createTextNode(input.text));

    if (input.done === true) {
      checkbox.checked = "true";
    }
      list.appendChild(checkbox);
      list.appendChild(label);

    if (input === '') {
      alert("Write what you want to do!");
    } else {
      document.querySelector("form").addEventListener("submit", e => {
      e.preventDefault();
      });
      document.getElementById("ul").appendChild(list);
    }

    if (input!== ''){
      var span = document.createElement("span");
      var text = document.createTextNode("\u00D7");
      span.className = "close";
      span.appendChild(text);
      list.appendChild(span);

    for (i = 0; i < close.length; i++) {
      close[i].onclick = function () {
      var div = this.parentElement;
      div.style.display = "none";
      if (close.onclick=true){
        let listIndex = $(this).data('index');
      let taskList = JSON.parse(localStorage.getItem('toDoList'));
      taskList.splice(listIndex,1);
      localStorage.setItem('toDoList', JSON.stringify(taskList));
      }
      }
    }
  }
}

//Click close button to hide element
  var close = document.getElementsByClassName("close");
  var i;
    for (i = 0; i < close.length; i++) {
      close[i].onclick = function () {
      var div = this.parentElement;
      div.style.display = "none";
      if (close.onclick=true){
        let listIndex = $(this).data('index');
      let taskList = JSON.parse(localStorage.getItem('toDoList'));
      taskList.splice(listIndex,1);
      localStorage.setItem('toDoList', JSON.stringify(taskList));
      }
      }
    }
    console.log(toDoList);
  </script>
</body>
</html>